<!-- LISTA DE PROYECTOS -->
<div class="card">
  <h2>Proyectos registrados </h2>

  <div *ngIf="proyectos.length === 0" class="no-data">
    <p>A√∫n no hay proyectos registrados en el sistema.</p>
  </div>

  <table class="table mt-4" *ngIf="proyectos.length > 0">
    <thead>
      <tr>
        <th>Nombre del Proyecto</th>
        <th>Actividad</th>
        <th>Necesidad</th>
        <th>Empresa vinculada</th>
        <th>Estado</th>
        <th>Descripci√≥n</th>
        <th style="width: 120px;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let proyecto of proyectos">
        <td>{{ proyecto.nombre }}</td>
        <td>{{ proyecto.actividad }}</td>
        <td>{{ proyecto.necesidad }}</td>
        <td>{{ proyecto.empresaVinculada }}</td>
        <td>{{ proyecto.estadoProyecto }}</td>
        <td class="descripcion-cell">
          {{ proyecto.descripcion }}
        </td>
        <td>
          <button (click)="abrirModalDocumentos(proyecto)" class="btn btn-sm btn-info">
            Detalles / archivos
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- MODAL: DATOS DEL PROYECTO + IM√ÅGENES + DOCUMENTOS -->
<div class="proyecto-modal-backdrop" *ngIf="mostrarModalDocs">
  <div class="proyecto-modal">
    <div class="modal-header">
      <div>
        <h3>{{ proyectoEnEdicion?.nombre || 'Proyecto y documentos' }}</h3>
        <p class="modal-subtitle" *ngIf="proyectoEnEdicion as p">
          <span class="badge badge-estado">{{ p.estadoProyecto || 'Sin estado' }}</span>
          <span class="badge badge-actividad">{{ p.actividad || 'Sin actividad' }}</span>
          <span class="badge badge-empresa">{{ p.empresaVinculada || 'Sin empresa vinculada' }}</span>
        </p>
      </div>
      <button type="button" class="btn-icon" (click)="cerrarModalDocumentos()">‚úñ</button>
    </div>

    <div class="modal-body" *ngIf="proyectoEnEdicion as p">
      <div class="modal-layout">
        <!-- COLUMNA IZQUIERDA: PORTADA + GALER√çA -->
        <div class="modal-left">
          <!-- Portada -->
          <div class="card soft-card portada-card">
            <h4>Imagen representativa</h4>

            <ng-container *ngIf="imagenes.length > 0; else noPortada">
              <img
                [src]="getMediaUrl(imagenes[0])"
                alt="Imagen representativa"
                class="portada-img"
              />
            </ng-container>

            <ng-template #noPortada>
              <div class="portada-placeholder">
                <span>Sin imagen representativa</span>
                <small>Sube una imagen en la secci√≥n de archivos</small>
              </div>
            </ng-template>
          </div>

          <!-- Galer√≠a de im√°genes -->
          <div class="card soft-card">
            <div class="card-header-inline">
              <h4>Galer√≠a de im√°genes</h4>
              <span class="pill">{{ imagenes.length }} imagen(es)</span>
            </div>

            <p *ngIf="imagenes.length === 0" class="text-muted">
              A√∫n no hay im√°genes cargadas para este proyecto.
            </p>

            <div class="imagenes-grid" *ngIf="imagenes.length > 0">
              <div class="imagen-item" *ngFor="let img of imagenes">
                <img [src]="getMediaUrl(img)" [alt]="img.fileName" />
                <div class="imagen-caption">
                  <span class="imagen-nombre" [title]="img.fileName">
                    {{ img.fileName }}
                  </span>
                  <div class="imagen-actions">
                    <button class="btn btn-xs btn-outline-primary"
                            (click)="verDocumento(img)">
                      Ver
                    </button>
                    <button class="btn btn-xs btn-warning"
                            (click)="seleccionarDocParaActualizar(img)">
                      Editar
                    </button>
                    <button class="btn btn-xs btn-danger"
                            (click)="eliminarDocumento(img)">
                      Eliminar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- COLUMNA DERECHA: DATOS + ARCHIVOS -->
        <div class="modal-right">
          <!-- DATOS DEL PROYECTO -->
          <div class="card soft-card">
            <h4>Datos del proyecto</h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre del proyecto</label>
                <input type="text"
                       [(ngModel)]="p.nombre"
                       name="nombreModal">
              </div>

              <div class="form-group">
                <label>Actividad</label>
                <input type="text"
                       [(ngModel)]="p.actividad"
                       name="actividadModal">
              </div>

              <div class="form-group">
                <label>Necesidad</label>
                <input type="text"
                       [(ngModel)]="p.necesidad"
                       name="necesidadModal">
              </div>

              <div class="form-group">
                <label>Empresa vinculada</label>
                <input type="text"
                       [(ngModel)]="p.empresaVinculada"
                       name="empresaVinculadaModal">
              </div>

              <div class="form-group">
                <label>Estado del proyecto</label>
                <input type="text"
                       [(ngModel)]="p.estadoProyecto"
                       name="estadoProyectoModal">
              </div>

              <div class="form-group full-width">
                <label>Descripci√≥n</label>
                <textarea [(ngModel)]="p.descripcion"
                          name="descripcionModal"
                          rows="4"></textarea>
              </div>
            </div>

            <button (click)="guardarCambiosProyecto()"
                    class="btn-primary btn-block">
              Guardar cambios del proyecto
            </button>
          </div>

          <!-- SUBIR NUEVO ARCHIVO -->
          <div class="card soft-card">
            <h4>Subir nuevo archivo (imagen o documento)</h4>
            <p class="text-muted">
              Puedes subir im√°genes (jpg, png, etc.) o documentos (PDF, Word, etc.).
            </p>
            <input id="fileInputDocsNuevo"
                   type="file"
                   (change)="onFileChangeNuevo($event)">
            <button (click)="subirDocumento()" class="btn-primary" style="margin-top: .5rem;">
              Subir archivo
            </button>
          </div>

          <!-- LISTA DE DOCUMENTOS (no imagen) -->
          <div class="card soft-card">
            <div class="card-header-inline">
              <h4>Documentos</h4>
              <span class="pill">{{ otrosDocumentos.length }} documento(s)</span>
            </div>

            <p *ngIf="otrosDocumentos.length === 0" class="text-muted">
              No se han subido documentos a√∫n.
            </p>

            <ul *ngIf="otrosDocumentos.length > 0" class="file-list">
              <li *ngFor="let doc of otrosDocumentos">
                <span class="file-name" [title]="doc.fileName">üìÑ {{ doc.fileName }}</span>

                <div class="file-actions">
                  <button (click)="verDocumento(doc)" class="btn btn-xs btn-info">
                    Ver
                  </button>

                  <button (click)="descargarDocumento(doc)" class="btn btn-xs btn-outline-primary">
                    Descargar
                  </button>

                  <button (click)="eliminarDocumento(doc)" class="btn btn-xs btn-danger">
                    Eliminar
                  </button>

                  <button (click)="seleccionarDocParaActualizar(doc)" class="btn btn-xs btn-warning">
                    Editar archivo
                  </button>
                </div>
              </li>
            </ul>
          </div>

          <!-- ACTUALIZAR DOCUMENTO / IMAGEN SELECCIONADO -->
          <div *ngIf="docParaActualizar" class="card soft-card">
            <h4>Actualizar archivo seleccionado</h4>
            <p>Archivo actual: <strong>{{ docParaActualizar.fileName }}</strong></p>
            <input id="fileInputUpdate"
                   type="file"
                   (change)="onFileChangeActualizar($event)">
            <button (click)="actualizarDocumento()" class="btn-primary" style="margin-top: .5rem;">
              Actualizar archivo
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" (click)="cerrarModalDocumentos()" class="btn-secondary">
        Cerrar
      </button>
    </div>
  </div>
</div>
